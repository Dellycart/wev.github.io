<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Rock Paper Scissors</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@400;600&family=Montserrat:wght@700&display=swap" rel="stylesheet">

    <link rel="icon" type="image/png" href="rock-paper-scissors.png" id="favicon-link">

    <style>
        /* --- General Body Styles --- */
        body {
            font-family: 'Jost', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* Changed height to min-height */
            background: radial-gradient(circle at center, #2c2c2c 0%, #1a1a1a 100%);
            color: #f0f0f0;
            margin: 0;
            padding: 8px; /* Minimal body padding to allow elements to touch edges */
            box-sizing: border-box;
            overflow-y: auto; /* Allow body to scroll if needed, for extreme cases */
            -webkit-overflow-scrolling: touch; /* Smoother scrolling on iOS */
        }

        /* --- Common Container Styles --- */
        .screen-container {
            background: linear-gradient(145deg, #333333, #222222);
            padding: 25px 35px; /* Reverted to original padding for overall aesthetic */
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.8);
            border: 2px solid #3a3a3a;
            text-align: center;
            width: 100%;
            max-width: 600px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center; /* For welcome screen */
            align-items: center;
            position: relative;
            flex-grow: 1;
            flex-shrink: 1;
            height: auto; /* Changed to auto to allow natural height based on content */
            min-height: calc(100vh - 16px); /* Ensure it takes at least full viewport height minus padding */
            max-height: calc(100vh - 16px); /* Keep max-height to limit its size */
            overflow-y: auto; /* Crucial: allow internal scrolling for the container */
            -webkit-overflow-scrolling: touch; /* Smoother scrolling on iOS */
        }
        /* --- Result Display (continued from your existing CSS) --- */
.play-again-btn { /* Style for the "Play Next Round" button */
    background-color: #00aaff; /* A primary blue, similar to overlay buttons */
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 25px;
    font-size: 1.05em;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    margin-top: 15px; /* Add some space above it */
    display: none; /* Keep it hidden by default, shown by JS */
}

.play-again-btn:hover {
    background-color: #0088cc;
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
}

.play-again-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}
        /* --- Welcome Screen Styles --- */
        #welcome-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-grow: 1;
            padding: 15px; /* Consistent with overall container */
            height: 100%;
        }

        #welcome-screen h2 {
            font-family: 'Montserrat', sans-serif;
            color: #00ff99;
            margin-bottom: 20px;
            font-size: 2em;
        }

        #welcome-screen p {
            font-size: 1em;
            color: #ccc;
            margin-bottom: 15px;
        }

        #welcome-screen input[type="text"] {
            width: 80%;
            padding: 10px 15px;
            margin-bottom: 20px;
            border: 2px solid #00e676;
            border-radius: 8px;
            background-color: #1a1a1a;
            color: #f0f0f0;
            font-size: 1.05em;
            text-align: center;
            outline: none;
            transition: border-color 0.3s ease;
        }

        #welcome-screen input[type="text"]::placeholder {
            color: #a0a0a0;
        }

        #welcome-screen input[type="text"]:focus {
            border-color: #00cc66;
        }

        #series-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 15px;
            margin-bottom: 20px;
            gap: 10px;
        }

        #series-selection label {
            font-size: 1em;
            color: #cccccc;
        }

        #series-length-select {
            padding: 8px 12px;
            border: 2px solid #00e676;
            border-radius: 8px;
            background-color: #1a1a1a;
            color: #f0f0f0;
            font-size: 1em;
            text-align: center;
            outline: none;
            transition: border-color 0.3s ease;
        }

        #series-length-select:focus {
            border-color: #00cc66;
        }

        #start-game-btn {
            background-color: #00e676;
            color: #1a1a1a;
            border: none;
            border-radius: 8px;
            padding: 12px 30px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        #start-game-btn:hover {
            background-color: #00b359;
            transform: translateY(-2px);
        }

        /* --- Main Game Screen --- */
        #game-container {
            display: none;
            justify-content: space-between;
            flex-direction: column;
            padding-top: 60px;
            padding-bottom: 20px;
            min-height: 100%;
        }

        /* --- Player vs Computer Text --- */
        .player-vs-computer {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
            font-size: 1.4em;
            font-weight: bold;
            color: #cccccc;
            flex-shrink: 0;
        }

        .player-vs-computer #player-name-display-game {
            color: #00e676;
        }

        .player-vs-computer #computer-label {
            color: #00aaff;
        }

        /* --- Series Score Display --- */
        .series-score {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.2em;
            font-weight: bold;
            color: #e6b800;
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        /* --- Game Area (Hands Display) --- */
        .game-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin-bottom: 15px;
            min-height: 160px;
            flex-shrink: 1;
            flex-grow: 1;
            position: relative; /* Needed for impact effects */
        }

        .hand {
            width: 130px;
            height: 130px;
            background-color: transparent;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transform: translateY(0);
            transition: transform 0.2s ease-out;
            transform-origin: bottom center;
        }

        #player-hand img, #computer-hand img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.5));
        }

        #computer-hand img {
            transform: scaleX(-1);
        }

        .hand.hidden {
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
        }

        /* --- Impact Effect --- */
        .impact-effect {
            position: absolute;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(255, 255, 0, 0.8), rgba(255, 140, 0, 0.5));
            border-radius: 50%;
            opacity: 0;
            transform: scale(0);
            animation: impact-burst 0.3s ease-out forwards;
            pointer-events: none;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
        }

        @keyframes impact-burst {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0);
            }
            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(2);
            }
        }

        /* --- Animations --- */
        @keyframes handShakePlayer {
            0%, 100% { transform: translateY(0) rotateZ(0deg); }
            25% { transform: translateY(-15px) rotateZ(-10deg); }
            75% { transform: translateY(-15px) rotateZ(10deg); }
        }

        @keyframes handShakeComputer {
            0%, 100% { transform: translateY(0) rotateZ(0deg); }
            25% { transform: translateY(-15px) rotateZ(10deg); }
            75% { transform: translateY(-15px) rotateZ(-10deg); }
        }

        @keyframes handReveal {
            0% { opacity: 0; transform: translateY(20px) scale(0.8); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* --- Countdown Animation (New) --- */
        .game-message.countdown-animate {
            font-size: 2.2em; /* Slightly larger during countdown */
            animation: countdown-pulse 0.8s ease-out forwards, countdown-color 0.8s ease-out forwards;
            color: #00ff99; /* Initial vibrant color */
            text-shadow: 0 0 8px rgba(0, 255, 153, 0.7);
        }

        @keyframes countdown-pulse {
            0% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes countdown-color {
            0% { color: #00ff99; } /* Greenish */
            33% { color: #ffff00; } /* Yellowish */
            66% { color: #ff00ff; } /* Purplish */
            100% { color: #f0f0f0; } /* Fade back to white */
        }


        /* --- Choice Buttons (initially visible, hidden during round) --- */
        .choices {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            flex-shrink: 0;
        }

        .choices.hidden {
            opacity: 0;
            height: 0;
            margin-bottom: 0;
            pointer-events: none;
            transform: translateY(20px);
        }

        .choice-btn {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 8px;

            background-color: #3b3b3b;
            border: 2px solid #5a5a5a;
            border-radius: 10px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.5);
            width: 120px;
            height: 120px;
            overflow: hidden;
        }

        .choice-btn:hover {
            background-color: #4a4a4a;
            border-color: #00e676;
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
        }

        .choice-btn:active {
            transform: translateY(0) scale(1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            background-color: #3a3a3a;
            border-color: #00cc66;
        }

        .choice-btn .choice-img {
            width: 70px;
            height: 70px;
            display: block;
            object-fit: contain;
            filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.5));
        }

        .choice-btn span {
            font-family: 'Jost', sans-serif;
            color: #e0e0e0;
            font-size: 0.95em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
        }


        /* --- Result Display --- */
        .result-display {
            min-height: 80px;
            margin-top: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
            position: relative; /* Needed for victory overlay */
        }

        .result-message {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.6em; /* Base size */
            font-weight: bold;
            color: #f0f0f0;
            margin-top: 10px;
            transition: all 0.3s ease; /* Add transition for smooth size change */
            letter-spacing: 1px;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.8);
        }

        .result-message.win { color: #00e676; }
        .result-message.lose { color: #ff3333; }
        .result-message.tie { color: #e6b800; }

        /* New class for enhanced series win/loss message */
        .result-message.series-end {
            font-size: 2em; /* Larger size for series end */
            color: #fff; /* Brighter color */
            transform: scale(1.1); /* Slightly pop out */
        }

        /* --- Victory/Defeat Overlay --- */
        #game-over-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7); /* Semi-transparent black overlay */
            display: none; /* Hidden by default */
            flex-direction: column; /* Changed to column for stacking buttons */
            justify-content: center;
            align-items: center;
            z-index: 30; /* Above all other game elements */
            opacity: 0;
            transition: opacity 0.5s ease;
            gap: 20px; /* Space between message and buttons */
        }

        #game-over-overlay.visible {
            display: flex;
            opacity: 1;
        }

        #overlay-message {
            font-family: 'Montserrat', sans-serif;
            font-size: 3em; /* Very large for impact */
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0,0,0,0.8), 0 0 20px rgba(255,255,255,0.3);
            margin-bottom: 0; /* Managed by gap in parent */
            opacity: 0;
            transform: translateY(-20px) scale(0.8);
            animation: overlay-text-in 0.8s ease-out forwards;
        }

        #overlay-message.win-color { color: #00ff99; }
        #overlay-message.lose-color { color: #ff6666; }

        @keyframes overlay-text-in {
            0% { opacity: 0; transform: translateY(-20px) scale(0.8); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }

        .overlay-buttons {
            display: flex;
            gap: 15px; /* Space between buttons */
            margin-top: 0; /* Managed by gap in parent */
        }

        .replay-series-btn, .main-menu-btn { /* Apply common styles to both overlay buttons */
            font-family: 'Montserrat', sans-serif;
            background-color: #00aaff;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 22px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            display: none; /* Hidden by default, shown by JS */
            letter-spacing: 0.8px;
            flex-shrink: 0;
        }

        .replay-series-btn:hover, .main-menu-btn:hover {
            background-color: #0088cc;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        /* --- Score Board (at bottom) --- */
        .score-board-bottom {
            display: flex;
            justify-content: space-around;
            width: 100%;
            padding: 10px 0;
            margin-top: 15px;
            border-top: 1px solid #4a4a4a;
            flex-shrink: 0;
        }

        .score-item p {
            margin: 0;
            font-size: 0.95em;
            color: #cccccc;
        }

        .score-item span {
            font-family: 'Montserrat', sans-serif;
            display: block;
            font-size: 1.8em;
            font-weight: bold;
            margin-top: 5px;
        }

        .score-item.won span { color: #00e676; }
        .score-item.lost span { color: #ff3333; }
        .score-item.draw span { color: #e6b800; }

        /* --- Game Controls (Sound/Share Buttons) - Top Right Positioning --- */
        .game-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            z-index: 20;
            flex-direction: row;
            align-items: center;
            flex-shrink: 0;
        }

        .control-btn {
            background-color: #555;
            color: #f0f0f0;
            border: none;
            border-radius: 5px;
            padding: 6px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            width: 38px;
            height: 38px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .control-btn:hover {
            background-color: #777;
            transform: none;
        }

        #sound-toggle-btn.on {
            background-color: #00e676;
            color: #1a1a1a;
        }

        #sound-toggle-btn.on:hover {
            background-color: #00b359;
        }

        /* --- Confetti Effect --- */
        #confetti-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 10;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: white;
            border-radius: 50%;
            opacity: 0;
            animation: confetti-fall 2s forwards ease-out;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotateZ(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotateZ(720deg);
                opacity: 0;
            }
        }


        /* --- Responsive Adjustments --- */

        /* General adjustments for medium screens (e.g., tablets, small laptops) */
        @media (max-width: 768px) {
            .screen-container {
                padding: 20px 30px;
            }
            #welcome-screen h2 {
                font-size: 1.8em;
            }
            .player-vs-computer {
                font-size: 1.2em;
            }
            .hand {
                width: 110px;
                height: 110px;
            }
            .choices {
                gap: 15px;
            }
            .choice-btn {
                width: 110px;
                height: 110px;
            }
            .choice-btn .choice-img {
                width: 65px;
                height: 65px;
            }
            .choice-btn span {
                font-size: 0.9em;
            }
            .result-message {
                font-size: 1.5em;
            }
            #overlay-message {
                font-size: 2.5em;
            }
            .score-item span {
                font-size: 1.7em;
            }
            .replay-series-btn, .main-menu-btn {
                font-size: 0.9em;
            }
            .control-btn {
                padding: 5px;
                font-size: 1em;
                width: 35px;
                height: 35px;
            }
        }

        /* Adjustments for smaller screens (e.g., large phones) */
        @media (max-width: 550px) {
            body {
                padding: 5px;
            }
            .screen-container {
                padding: 15px;
                max-height: calc(100vh - 10px);
            }
            #welcome-screen h2 {
                font-size: 1.5em;
            }
            #welcome-screen p {
                font-size: 0.85em;
            }
            #welcome-screen input[type="text"] {
                padding: 7px 10px;
                font-size: 0.9em;
            }
            #start-game-btn {
                padding: 10px 22px;
                font-size: 1em;
            }

            #game-container {
                padding-top: 50px;
                padding-bottom: 15px;
            }

            .player-vs-computer {
                font-size: 1em;
                gap: 10px;
                margin-bottom: 15px;
            }
            .game-area {
                gap: 15px;
                margin-bottom: 20px;
                min-height: 120px;
            }
            .hand {
                width: 90px;
                height: 90px;
            }
            .choices {
                gap: 10px;
                margin-bottom: 15px;
            }
            .choice-btn {
                width: 90px;
                height: 90px;
                padding: 6px;
            }
            .choice-btn .choice-img {
                width: 55px;
                height: 55px;
            }
            .choice-btn span {
                font-size: 0.8em;
            }
            .result-message {
                font-size: 1.3em;
                min-height: 60px;
                margin-top: 8px;
            }
            #overlay-message {
                font-size: 2.5em;
            }
            .replay-series-btn, .main-menu-btn {
                padding: 8px 18px;
                font-size: 0.95em;
                margin-top: 15px;
            }
            .score-board-bottom {
                padding: 10px 0;
                margin-top: 20px;
            }
            .score-item p {
                font-size: 0.8em;
            }
            .score-item span {
                font-size: 1.5em;
            }
            .control-btn {
                padding: 5px;
                font-size: 1em;
                width: 35px;
                height: 35px;
            }
        }

        /* Adjustments for very small screens (e.g., narrow phones - ~320-375px width) */
        @media (max-width: 400px) {
            .screen-container {
                padding: 10px;
                max-height: calc(100vh - 20px);
                overflow-y: auto; /* Ensure scrolling for very small screens */
            }
            #welcome-screen h2 {
                font-size: 1.3em;
            }
            #welcome-screen input[type="text"] {
                width: 90%;
            }

            #game-container {
                padding-top: 45px;
                padding-bottom: 10px;
                min-height: auto; /* Allow it to shrink if needed, but flex-grow will stretch it */
                overflow-y: auto; /* Make sure the game container also scrolls if its content is too tall */
                flex-grow: 1; /* Allow it to grow within screen-container */
            }

            .player-vs-computer {
                font-size: 0.9em;
                gap: 8px;
                margin-bottom: 10px;
            }
            .game-area {
                flex-direction: column;
                gap: 10px;
                margin-bottom: 15px;
                min-height: 100px;
            }
            .hand {
                width: 70px;
                height: 70px;
            }
            #computer-hand img {
                 transform: scaleX(1);
            }
            .choices {
                flex-direction: column;
                gap: 8px;
            }
            .choice-btn {
                width: 95%;
                max-width: 150px;
                height: auto;
                padding: 8px;
                flex-direction: row;
                gap: 12px;
            }
            .choice-btn .choice-img {
                width: 45px;
                height: 45px;
            }
            .choice-btn span {
                font-size: 0.85em;
            }
            .result-message {
                font-size: 1.1em;
                min-height: 50px;
                margin-top: 5px;
            }
            #overlay-message {
                font-size: 1.8em;
            }
            .replay-series-btn, .main-menu-btn {
                padding: 6px 15px;
                font-size: 0.9em;
                margin-top: 10px;
            }
            .score-board-bottom {
                padding: 8px 0;
                margin-top: 15px;
            }
            .score-item p {
                font-size: 0.75em;
            }
            .score-item span {
                font-size: 1.3em;
            }
            .control-btn {
                padding: 3px;
                font-size: 0.8em;
                width: 30px;
                height: 30px;
            }
        }
    </style>
</head>
<body>
    <div id="welcome-screen" class="screen-container">
        <h2>Welcome to Animated Rock Paper Scissors!</h2>
        <p>What's your name, Challenger?</p>
        <input type="text" id="player-name-input" placeholder="Enter your name" maxlength="15">

        <div id="series-selection">
            <label for="series-length-select">Play Best of:</label>
            <select id="series-length-select">
                <option value="1">1 Round (Single)</option>
                <option value="3" selected>3 Rounds</option>
                <option value="5">5 Rounds</option>
                <option value="7">7 Rounds</option>
            </select>
        </div>

        <button id="start-game-btn">Start Game</button>
    </div>

    <div id="game-container" class="screen-container">
        <div class="game-controls">
            <button id="sound-toggle-btn" class="control-btn">&#128266;</button>
            <button id="share-btn" class="control-btn">&#128271;</button>
        </div>

        <div class="player-vs-computer">
            <span id="player-name-display-game">Player</span>
            <span>v/s</span>
            <span id="computer-label">Computer</span>
        </div>

        <div class="series-score">
            <span id="player-series-wins">0</span> - <span id="computer-series-wins">0</span> (Best of <span id="current-series-length">3</span>)
        </div>

        <div class="game-area">
            <div id="player-hand" class="hand hidden">
                <img id="player-hand-img" src="Rock.png" alt="Player Hand">
            </div>
            <div id="computer-hand" class="hand hidden">
                <img id="computer-hand-img" src="Rock.png" alt="Computer Hand">
            </div>
            <div id="impact-effect" class="impact-effect"></div>
        </div>

        <div class="choices" id="choices-container">
            <button id="rock" class="choice-btn">
                <img src="Rock.png" alt="Rock Hand" class="choice-img">
                <span>Rock</span>
            </button>
            <button id="paper" class="choice-btn">
                <img src="Paper.png" alt="Paper Hand" class="choice-img">
                <span>Paper</span>
            </button>
            <button id="scissors" class="choice-btn">
                <img src="Scissors.png" alt="Scissors Hand" class="choice-img">
                <span>Scissors</span>
            </button>
        </div>

        <div class="result-display">
            <p id="game-message" class="result-message">Select your Weapon</p>
            <button id="play-again-btn" class="play-again-btn">Play Again</button>
        </div>

        <div class="score-board-bottom">
            <div class="score-item won">
                <p>Won</p>
                <span id="player-score">0</span>
            </div>
            <div class="score-item lost">
                <p>Lost</p>
                <span id="computer-score">0</span>
            </div>
            <div class="score-item draw">
                <p>Draw</p>
                <span id="tie-score">0</span>
            </div>
        </div>

        <audio id="click-sound" src="click.mp3" preload="auto"></audio>
        <audio id="win-sound" src="win.mp3" preload="auto"></audio>
        <audio id="error-sound" src="error.mp3" preload="auto"></audio>
        <audio id="countdown-sound" src="countdown.mp3" preload="auto"></audio>
        <audio id="impact-sound" src="impact.mp3" preload="auto"></audio>
        <audio id="game-over-sound" src="gameover.mp3" preload="auto"></audio>


        <div id="confetti-container"></div>
        <div id="game-over-overlay">
            <p id="overlay-message"></p>
            <div class="overlay-buttons">
                <button id="replay-series-btn" class="replay-series-btn">Play Again</button>
                <button id="main-menu-btn" class="main-menu-btn">Main Menu</button>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        // Welcome Screen
        const welcomeScreen = document.getElementById('welcome-screen');
        const playerNameInput = document.getElementById('player-name-input');
        const seriesLengthSelect = document.getElementById('series-length-select');
        const startGameBtn = document.getElementById('start-game-btn');

        // Game Screen
        const gameContainer = document.getElementById('game-container');
        const playerNameDisplayGame = document.getElementById('player-name-display-game');
        const playerHandDiv = document.getElementById('player-hand');
        const playerHandImg = document.getElementById('player-hand-img');
        const computerHandDiv = document.getElementById('computer-hand');
        const computerHandImg = document.getElementById('computer-hand-img');
        const gameMessage = document.getElementById('game-message');
        const choicesContainer = document.getElementById('choices-container');
        const choiceButtons = document.querySelectorAll('.choice-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        const playerScoreSpan = document.getElementById('player-score');
        const computerScoreSpan = document.getElementById('computer-score');
        const tieScoreSpan = document.getElementById('tie-score');

        // Elements for series score
        const playerSeriesWinsSpan = document.getElementById('player-series-wins');
        const computerSeriesWinsSpan = document.getElementById('computer-series-wins');
        const currentSeriesLengthSpan = document.getElementById('current-series-length');

        // New elements for visual/audio enhancements and overlay buttons
        const impactEffectDiv = document.getElementById('impact-effect');
        const gameOverOverlay = document.getElementById('game-over-overlay');
        const overlayMessage = document.getElementById('overlay-message');
        const replaySeriesBtn = document.getElementById('replay-series-btn');
        const mainMenuBtn = document.getElementById('main-menu-btn');


        // Elements for sounds and effects
        const clickSound = document.getElementById('click-sound');
        const winSound = document.getElementById('win-sound');
        const errorSound = document.getElementById('error-sound');
        const soundToggleButton = document.getElementById('sound-toggle-btn');
        const shareButton = document.getElementById('share-btn');
        const confettiContainer = document.getElementById('confetti-container');
        const countdownSound = document.getElementById('countdown-sound');
        const impactSound = document.getElementById('impact-sound');
        const gameOverSound = document.getElementById('game-over-sound');


        // Favicon
        const faviconLink = document.getElementById('favicon-link');
        const faviconImages = ['Rock.png', 'Paper.png', 'Scissors.png'];
        let currentFaviconIndex = 0;
        let faviconIntervalId;

        // --- Game Variables ---
        let playerName = "Player";
        let playerScore = 0;
        let computerScore = 0;
        let tieScore = 0;

        let playerSeriesWins = 0;
        let computerSeriesWins = 0;
        let seriesLength = 3;
        let roundsPlayed = 0;

        const choices = ['rock', 'paper', 'scissors'];
        let isSoundEnabled = true;

        // Mapping for image files
        const choiceImageMap = {
            'rock': 'Rock.png',
            'paper': 'Paper.png',
            'scissors': 'Scissors.png'
        };

        // --- Functions ---

        // Favicon animation
        function changeFavicon() {
            faviconLink.href = faviconImages[currentFaviconIndex];
            currentFaviconIndex = (currentFaviconIndex + 1) % faviconImages.length;
        }

        // Get computer's random choice
        function getComputerChoice() {
            const randomIndex = Math.floor(Math.random() * choices.length);
            return choices[randomIndex];
        }

        // Determine the winner
        function determineWinner(playerChoice, computerChoice) {
            if (playerChoice === computerChoice) {
                return 'tie';
            } else if (
                (playerChoice === 'rock' && computerChoice === 'scissors') ||
                (playerChoice === 'paper' && computerChoice === 'rock') ||
                (playerChoice === 'scissors' && computerChoice === 'paper')
            ) {
                return 'win';
            } else {
                return 'lose';
            }
        }

        // --- Audio Functions ---
        function playSound(audioElement) {
            if (isSoundEnabled) {
                audioElement.currentTime = 0;
                audioElement.play().catch(e => console.error("Audio playback failed:", e));
            }
        }

        function playClickSound() {
            playSound(clickSound);
        }

        function playWinSound() {
            playSound(winSound);
        }

        function playErrorSound() {
            playSound(errorSound);
        }

        function playCountdownSound() {
            playSound(countdownSound);
        }

        function playImpactSound() {
            playSound(impactSound);
        }

        function playGameOverSound() {
            playSound(gameOverSound);
        }

        // --- Sound Toggle Function ---
        function toggleSound() {
            isSoundEnabled = !isSoundEnabled;
            if (isSoundEnabled) {
                soundToggleButton.innerHTML = '&#128266;'; /* Speaker with sound */
                soundToggleButton.classList.add('on');
            } else {
                soundToggleButton.innerHTML = '&#128263;'; /* Speaker mute */
                soundToggleButton.classList.remove('on');
            }
        }

        // --- Confetti Effect ---
        function triggerConfetti() {
            const colors = ['#f00', '#0f0', '#00f', '#ff0', '#0ff', '#f0f', '#f80', '#80f'];
            const numConfetti = 50;

            for (let i = 0; i < numConfetti; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                confetti.style.animationDuration = `${2 + Math.random() * 1}s`;
                confetti.style.transform = `scale(${0.5 + Math.random() * 0.5})`;
                confetti.style.borderRadius = `${Math.random() > 0.5 ? '50%' : '0'}`;

                confettiContainer.appendChild(confetti);

                confetti.addEventListener('animationend', () => {
                    confetti.remove();
                });
            }
        }

        // --- Share Function ---
        function shareGame() {
            const shareData = {
                title: 'Rock Paper Scissors Game',
                text: `I just played Rock Paper Scissors! Can you beat my high score? Try it out!`,
                url: window.location.href
            };

            if (navigator.share) {
                navigator.share(shareData)
                    .then(() => console.log('Game shared successfully'))
                    .catch((error) => console.error('Error sharing game:', error));
            } else {
                // Fallback for browsers that do not support navigator.share
                const dummyElement = document.createElement('textarea');
                document.body.appendChild(dummyElement);
                dummyElement.value = shareData.url;
                dummyElement.select();
                document.execCommand('copy');
                document.body.removeChild(dummyElement);
                alert('Game link copied to clipboard! You can paste it to share.');
            }
        }

        // --- Core Game Round Logic after countdown ---
        function executeRoundLogic(playerChoice) {
            const computerChoice = getComputerChoice();

            playerHandImg.src = choiceImageMap[playerChoice];
            computerHandImg.src = choiceImageMap[computerChoice];

            // Apply reveal animation
            playerHandDiv.style.animation = 'handReveal 0.5s ease-out forwards';
            computerHandDiv.style.animation = 'handReveal 0.5s ease-out forwards';

            // Trigger impact effect when hands clash
            impactEffectDiv.style.animation = 'none'; // Reset animation
            void impactEffectDiv.offsetWidth; // Trigger reflow
            impactEffectDiv.style.animation = 'impact-burst 0.3s ease-out forwards';
            playImpactSound(); // Play impact sound

            const result = determineWinner(playerChoice, computerChoice);
            roundsPlayed++;

            if (result === 'win') {
                playerScore++;
                gameMessage.textContent = `${playerName} Wins Round!`;
                gameMessage.classList.add('win');
                playWinSound();
            } else if (result === 'lose') {
                computerScore++;
                gameMessage.textContent = `Computer Wins Round!`;
                gameMessage.classList.add('lose');
                playErrorSound(); // Play a sound for losing
            } else {
                tieScore++;
                gameMessage.textContent = `It's a Tie!`;
                gameMessage.classList.add('tie');
            }

            playerScoreSpan.textContent = playerScore;
            computerScoreSpan.textContent = computerScore;
            tieScoreSpan.textContent = tieScore;

            setTimeout(() => {
                const targetWins = Math.ceil(seriesLength / 2);
                let seriesWinner = null;

                if (playerScore >= targetWins) {
                    seriesWinner = 'player';
                    playerSeriesWins++;
                } else if (computerScore >= targetWins) {
                    seriesWinner = 'computer';
                    computerSeriesWins++;
                }

                if (seriesWinner) {
                    // Show full screen game over overlay
                    gameOverOverlay.classList.add('visible');
                    // Ensure overlay buttons are visible
                    replaySeriesBtn.style.display = 'block';
                    mainMenuBtn.style.display = 'block';

                    if (seriesWinner === 'player') {
                        overlayMessage.innerHTML = `${playerName} WINS THE SERIES! &#127881;`;
                        overlayMessage.classList.add('win-color');
                        playWinSound();
                        triggerConfetti();
                    } else {
                        overlayMessage.innerHTML = `COMPUTER WINS THE SERIES! &#128128;`;
                        overlayMessage.classList.add('lose-color');
                        playGameOverSound(); // Play game over sound for loss
                    }
                    overlayMessage.style.animation = 'none'; // Reset animation
                    void overlayMessage.offsetWidth; // Trigger reflow
                    overlayMessage.style.animation = 'overlay-text-in 0.8s ease-out forwards';

                    // Update series wins display
                    playerSeriesWinsSpan.textContent = playerSeriesWins;
                    computerSeriesWinsSpan.textContent = computerSeriesWins;

                    // Reset round scores for the next series, but keep series scores
                    playerScore = 0;
                    computerScore = 0;
                    tieScore = 0;
                    roundsPlayed = 0;

                } else {
                    // Continue to next round in series
                    gameMessage.textContent = `Round Over. Select Next Weapon!`;
                    gameMessage.classList.add(result);
                    playAgainBtn.textContent = 'Play Next Round';
                    playAgainBtn.style.display = 'block';
                }
            }, 500); // Duration of reveal animation
        }


        // --- Main Play Round function (with countdown) ---
        function playRound(playerChoice) {
            choicesContainer.classList.add('hidden');
            playAgainBtn.style.display = 'none'; // Hide "Play Next Round" button

            gameMessage.classList.remove('win', 'lose', 'tie', 'series-end'); // Clear all previous stylings

            playerHandImg.src = choiceImageMap['rock'];
            computerHandImg.src = choiceImageMap['rock'];

            playerHandDiv.classList.remove('hidden');
            computerHandDiv.classList.remove('hidden');

            // Initial shake animation for countdown
            playerHandDiv.style.animation = 'handShakePlayer 0.5s infinite alternate';
            computerHandDiv.style.animation = 'handShakeComputer 0.5s infinite alternate';

            let countdown = 3;
            gameMessage.textContent = `Ready? ${countdown}...`;
            gameMessage.classList.add('countdown-animate'); // Add class for countdown animation
            playCountdownSound();

            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    gameMessage.textContent = `${countdown}...`;
                    gameMessage.style.animation = 'none'; // Reset animation
                    void gameMessage.offsetWidth; // Trigger reflow
                    gameMessage.style.animation = 'countdown-pulse 0.8s ease-out forwards, countdown-color 0.8s ease-out forwards';
                    playCountdownSound();
                } else if (countdown === 0) {
                    gameMessage.textContent = `GO!`;
                    gameMessage.style.animation = 'none'; // Reset animation
                    void gameMessage.offsetWidth; // Trigger reflow
                    gameMessage.style.animation = 'countdown-pulse 0.8s ease-out forwards, countdown-color 0.8s ease-out forwards';
                    playCountdownSound();
                } else {
                    clearInterval(countdownInterval);
                    gameMessage.classList.remove('countdown-animate'); // Remove countdown animation class
                    playerHandDiv.style.animation = 'none'; // Stop shake animation
                    computerHandDiv.style.animation = 'none';
                    executeRoundLogic(playerChoice); // Execute actual round logic after countdown
                }
            }, 800);
        }

        // Reset game state for next round or new series
        function resetGameArea() {
            playerHandDiv.classList.add('hidden');
            computerHandDiv.classList.add('hidden');
            playerHandDiv.style.animation = 'none';
            computerHandDiv.style.animation = 'none';

            choicesContainer.classList.remove('hidden');
            playAgainBtn.style.display = 'none';
            gameMessage.textContent = 'Select your Weapon';
            gameMessage.classList.remove('win', 'lose', 'tie', 'series-end', 'countdown-animate'); // Clear all result stylings and countdown class
            impactEffectDiv.style.animation = 'none'; // Clear any lingering impact effect

            // Ensure overlay buttons are hidden when game area is reset
            replaySeriesBtn.style.display = 'none';
            mainMenuBtn.style.display = 'none';
        }

        function resetAllScoresAndSeries() {
            playerScore = 0;
            computerScore = 0;
            tieScore = 0;
            playerSeriesWins = 0;
            computerSeriesWins = 0;
            roundsPlayed = 0;
            playerScoreSpan.textContent = playerScore;
            computerScoreSpan.textContent = computerScore;
            tieScoreSpan.textContent = tieScore;
            playerSeriesWinsSpan.textContent = playerSeriesWins;
            computerSeriesWinsSpan.textContent = computerSeriesWins;
            resetGameArea();
        }

        // --- Event Listeners ---
        startGameBtn.addEventListener('click', () => {
            const inputName = playerNameInput.value.trim();
            if (inputName) {
                playerName = inputName;
            } else {
                playerName = "Challenger";
            }
            playerNameDisplayGame.textContent = playerName;

            seriesLength = parseInt(seriesLengthSelect.value);
            currentSeriesLengthSpan.textContent = seriesLength;

            welcomeScreen.style.display = 'none';
            gameContainer.style.display = 'flex';

            faviconIntervalId = setInterval(changeFavicon, 2000);
            resetAllScoresAndSeries();
        });

        choiceButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Only allow choices if game over overlay is NOT visible and game is ready for input
                if (!gameOverOverlay.classList.contains('visible') && gameMessage.textContent.includes("Select your Weapon")) {
                    playClickSound();
                    const playerChoice = button.id;
                    playRound(playerChoice);
                } else if (gameOverOverlay.classList.contains('visible')) {
                    // Do nothing if game over overlay is visible, user must click replay/menu button
                } else {
                    // This case means a round is in progress (e.g., during countdown or hand reveal)
                    // Optionally, provide feedback: gameMessage.textContent = "Round in progress!";
                }
            });
        });

        playAgainBtn.addEventListener('click', () => {
            // This button is only for "Play Next Round" within an ongoing series
            resetGameArea();
        });

        // Event listener for the "Play Again" button on the OVERLAY (Replay Series)
        replaySeriesBtn.addEventListener('click', () => {
            gameOverOverlay.classList.remove('visible'); // Hide the overlay
            // Game container remains visible, just reset the scores for a new series
            resetAllScoresAndSeries(); // Reset all scores for a brand new series, keeping current player/series length
        });

        // Event listener for the "Main Menu" button on the OVERLAY
        mainMenuBtn.addEventListener('click', () => {
            gameOverOverlay.classList.remove('visible'); // Hide the overlay
            gameContainer.style.display = 'none'; // Hide the game screen
            welcomeScreen.style.display = 'flex'; // Show the welcome screen
            resetAllScoresAndSeries(); // Reset all scores for a brand new game
        });

        soundToggleButton.addEventListener('click', toggleSound);
        shareButton.addEventListener('click', shareGame);

        // --- Initial Setup ---
        // Replace unicode icons with actual emojis for better compatibility and visual appeal
        soundToggleButton.innerHTML = '&#128266;'; // Speaker with sound emoji
        shareButton.innerHTML = '&#128279;'; // Link emoji

        soundToggleButton.classList.add('on');

        currentSeriesLengthSpan.textContent = seriesLengthSelect.value;
    </script>
</body>
</html>